<view class="planner-page {{pageBgClass}}">
  <scroll-view scroll-y class="scroll-content" show-scrollbar="{{false}}">
    
    <!-- å¤´éƒ¨å¯¼èˆª -->
    <view class="header">
      <view class="back-icon">ğŸ”™</view>
      <text class="page-title">å®šåˆ¶å¿ƒåŠ¨å‚æ•°</text>
    </view>

    <!-- 1. å…³ç³»æ°”æ³¡ (Bubble) -->
    <view class="card-box section-card">
      <view class="section-header">
        <text class="icon">ğŸ’</text> <text>ä½ ä»¬ç°åœ¨çš„çŠ¶æ€ï¼Ÿ</text>
      </view>
      <view class="bubble-rack">
        <block wx:for="{{relations}}" wx:key="id">
          <view 
            class="bubble {{selectedRelation === index ? 'active' : ''}}"
            style="background-color: {{item.color}}"
            bindtap="selectRelation" 
            data-index="{{index}}"
          >
            <text class="bubble-main">{{item.label}}</text>
            <text class="bubble-sub">{{item.sub}}</text>
          </view>
        </block>
      </view>
    </view>

    <!-- 2. æ—¶é—´è½¬ç›˜ (Time) -->
    <view class="card-box section-card">
      <view class="section-header">
        <text class="icon">ğŸ•°ï¸</text> <text>æ‰“ç®—ä»€ä¹ˆæ—¶å€™å»ï¼Ÿ</text>
      </view>
      <view class="time-row">
        <block wx:for="{{times}}" wx:key="index">
          <view class="time-item {{selectedTime === index ? 'active' : ''}}" bindtap="selectTime" data-index="{{index}}">
            <text class="time-emoji">{{item.icon}}</text>
            <text class="time-label">{{item.name}}</text>
          </view>
        </block>
      </view>
    </view>

    <!-- 3. é¢„ç®—é‡‘å¸å † (Budget) -->
    <view class="card-box section-card">
      <view class="section-header">
        <text class="icon">ğŸ’¸</text> <text>å‡†å¤‡äº†å¤šå°‘ç±³ï¼Ÿ</text>
      </view>
      
      <view class="budget-visual-area">
        <text class="budget-number">Â¥{{budget}}</text>
        
        <!-- é‡‘å¸å †ç§¯æ±  -->
        <view class="coin-pool">
          <block wx:for="{{coins}}" wx:key="id">
            <view class="coin" 
              style="left: {{item.left}}%; transform: rotate({{item.rotate}}deg); animation-delay: {{item.animDelay}}s;">
              {{item.type}}
            </view>
          </block>
        </view>
      </view>

      <slider 
        block-size="28" 
        block-color="#FF6B6B" 
        activeColor="#FFD700" 
        backgroundColor="#f0f0f0" 
        value="{{budget}}" 
        min="0" max="5000" step="100" 
        bindchanging="onBudgetChange" 
        bindchange="onBudgetChange"
      />
      <view class="slider-labels">
        <text>ç©·æ¸¸</text>
        <text>åœŸè±ª</text>
      </view>
    </view>

    <!-- 4. æ—¶ç©ºä¹‹é—¨ (Space) -->
    <view class="card-box section-card space-row">
      <picker mode="date" value="{{date}}" bindchange="bindDateChange">
        <view class="picker-btn">
          <text>ğŸ“… {{date}}</text>
        </view>
      </picker>
      
      <view class="picker-btn location-btn" bindtap="chooseLocation">
        <text class="pin-anim">ğŸ“</text> 
        <text class="loc-text">{{locationName}}</text>
      </view>
    </view>

    <view class="footer-spacer"></view>
  </scroll-view>

  <!-- åº•éƒ¨æ‚¬æµ®æŒ‰é’® -->
  <view class="bottom-bar">
    <button class="coin-btn" hover-class="hover-btn" bindtap="submitConfig">
      <view class="coin-slot"></view>
      <text>æŠ•å…¥ç¡¬å¸ï¼Œå¼€å§‹ï¼ğŸª™</text>
    </button>
  </view>
</view>